**旧ファイル名**: `technical_indicators_visualization_system.md`

# テクニカル指標可視化システム 設計書

## 1. システム概要

### システム名

**Technical Indicators Visualization System**

### 目的

時間足ごとにテクニカル指標を組み合わせて視認性の高い出力を提供し、投資判断をサポートする統合可視化システム

### 主な機能

- **時間足別統合表示**: 同一タイムスタンプの全指標を横並び表示
- **指標組み合わせ分析**: 複数指標の同時分析と相関性の可視化
- **視認性向上機能**: カラーコーディング、グラフィカル表示、統計サマリー
- **シグナル分析**: 買い/売りシグナルの自動判定とアラート
- **CLI 統合**: コマンドラインからの直感的な操作
- **リアルタイム分析**: 最新データの即座な可視化

## 2. システム構成

### 技術スタック

- **Backend**: Python 3.9+
- **Database**: SQLite (統合データベース)
- **Libraries**:
  - **TA-Lib**: 高性能テクニカル指標計算
  - **Pandas**: データ処理・分析
  - **Rich**: 美しい CLI 表示
  - **SQLAlchemy**: データベース ORM
  - **Typer**: CLI フレームワーク
- **External APIs**: Yahoo Finance API (価格データ取得)

### アーキテクチャ

```
┌─────────────────────────────────────────────────────────────────┐
│                    CLI Layer (Typer)                            │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │   visualize     │  │  calculate      │  │   show          │  │
│  │   command       │  │  command        │  │   command       │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────────┐
│                  Business Logic Layer                           │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ Technical       │  │ Unified         │  │ Data            │  │
│  │ Visualizer      │  │ Technical       │  │ Calculator      │  │
│  │                 │  │                 │  │                 │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────────┐
│                    Data Layer                                   │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ Technical       │  │ Price Data      │  │ Yahoo Finance   │  │
│  │ Indicators      │  │ Repository      │  │ Client          │  │
│  │ Repository      │  │                 │  │                 │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────────┐
│                   Database Layer                                │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │              SQLite Database                                │  │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐  │  │
│  │  │ technical_      │  │ price_data      │  │ exchange_   │  │  │
│  │  │ indicators      │  │                 │  │ analytics   │  │  │
│  │  └─────────────────┘  └─────────────────┘  └─────────────┘  │  │
│  └─────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

## 3. テクニカル指標詳細仕様

### 3.1 対応指標一覧

#### 3.1.1 モメンタム指標

##### RSI (Relative Strength Index)

- **計算方法**: TA-Lib RSI 関数
- **期間**: 14 日（デフォルト）
- **範囲**: 0-100
- **シグナル**:
  - **過買い**: 70 以上（売りシグナル）
  - **過売り**: 30 以下（買いシグナル）
  - **中立**: 30-70
- **視覚化**: 赤（過買い）、緑（過売り）、白（中立）

##### MACD (Moving Average Convergence Divergence)

- **計算方法**: TA-Lib MACD 関数
- **パラメータ**: Fast=12, Slow=26, Signal=9
- **出力**: MACD 線、シグナル線、ヒストグラム
- **シグナル**:
  - **買い**: MACD > 0（陽性）
  - **売り**: MACD < 0（陰性）
- **視覚化**: 緑（陽性）、赤（陰性）

##### ストキャスティクス (Stochastic Oscillator)

- **計算方法**: TA-Lib STOCH 関数
- **パラメータ**: FastK=14, SlowK=3, SlowD=3
- **範囲**: 0-100
- **シグナル**:
  - **過買い**: 80 以上（売りシグナル）
  - **過売り**: 20 以下（買いシグナル）
- **視覚化**: 赤（過買い）、緑（過売り）、白（中立）

#### 3.1.2 トレンド指標

##### 移動平均線 (Moving Averages)

###### SMA (Simple Moving Average)

- **計算方法**: TA-Lib SMA 関数
- **期間**: 5, 10, 20, 50, 100, 200 日
- **用途**: トレンド方向の判定、サポート・レジスタンス

###### EMA (Exponential Moving Average)

- **計算方法**: TA-Lib EMA 関数
- **期間**: 12, 26 日
- **用途**: MACD 計算の基盤、短期トレンド分析

##### ボリンジャーバンド (Bollinger Bands)

- **計算方法**: TA-Lib BBANDS 関数
- **パラメータ**: 期間=20, 標準偏差=2
- **出力**: 上バンド、中バンド（SMA）、下バンド
- **用途**: ボラティリティ分析、価格チャネル判定

#### 3.1.3 ボラティリティ指標

##### ATR (Average True Range)

- **計算方法**: TA-Lib ATR 関数
- **期間**: 14 日
- **用途**: ボラティリティ測定、ストップロス設定

### 3.2 時間足対応

#### 対応時間足

- **M5**: 5 分足（短期分析）
- **H1**: 1 時間足（中期分析）
- **H4**: 4 時間足（中長期分析）
- **D1**: 日足（長期分析）

#### データ取得期間

- **M5**: 7 日分
- **H1**: 30 日分
- **H4**: 60 日分
- **D1**: 365 日分

### 3.3 指標組み合わせ戦略

#### 3.3.1 トレンド確認戦略

```
RSI + MACD + 移動平均線
├── RSI: モメンタム確認
├── MACD: トレンド方向確認
└── 移動平均線: サポート・レジスタンス確認
```

#### 3.3.2 エントリー戦略

```
RSI + ストキャスティクス + ボリンジャーバンド
├── RSI: 過買い/過売り判定
├── ストキャスティクス: エントリータイミング
└── ボリンジャーバンド: 価格チャネル確認
```

#### 3.3.3 リスク管理戦略

```
ATR + ボリンジャーバンド + 移動平均線
├── ATR: ボラティリティ測定
├── ボリンジャーバンド: 価格範囲確認
└── 移動平均線: トレンド確認
```

## 4. 可視化機能詳細

### 4.1 CLI コマンド仕様

#### 基本コマンド

```bash
exchange-analytics data visualize [OPTIONS]
```

#### オプション

- `--timeframe, -tf`: 時間足指定 (M5, H1, H4, D1)
- `--days, -d`: 表示期間（日数）
- `--detailed`: 詳細表示モード
- `--indicators, -i`: 表示する指標 (all, rsi, macd, bb, ma, stoch, atr)

#### 使用例

```bash
# 基本表示（M5時間足、7日間、全指標）
exchange-analytics data visualize

# 特定時間足・期間指定
exchange-analytics data visualize --timeframe H1 --days 3

# 特定指標のみ表示
exchange-analytics data visualize --indicators rsi,macd

# 詳細表示
exchange-analytics data visualize --detailed --timeframe D1
```

### 4.2 表示形式

#### 4.2.1 ヘッダー表示

```
╭────────────────────────────── 📊 USD/JPY - M5時間足 テクニカル指標分析 ───────────────────────────────╮
│                                                                                                       │
│  期間: 7日 | データ件数: 805件 | 生成時刻: 2025-08-14 15:17:32                                        │
│                                                                                                       │
╰───────────────────────────────────────────────────────────────────────────────────────────────────────╯
```

#### 4.2.2 サマリーテーブル

```
📈 最新テクニカル指標サマリー
================================================================================
┏━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━┓
┃ タイムスタンプ    ┃ RSI       ┃ MACD      ┃ BB        ┃ SMA       ┃ STOCH     ┃
┡━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━┩
│ 08-11 15:20       │ 55.02     │ 0.01      │ 147.56    │ 147.51    │ 38.34     │
│ 08-11 15:25       │ 60.99     │ 0.01      │ 147.56    │ 147.53    │ 48.58     │
└───────────────────┴───────────┴───────────┴───────────┴───────────┴───────────┘
```

#### 4.2.3 統計サマリー

```
📋 統計サマリー
==================================================
┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓
┃ 指標       ┃ 平均値       ┃ 最小値       ┃ 最大値       ┃ トレンド        ┃
┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩
│ RSI        │ 50.50        │ 17.71        │ 77.46        │ 下降            │
│ MACD       │ -0.00        │ -0.15        │ 0.06         │ 下降            │
└────────────┴──────────────┴──────────────┴──────────────┴─────────────────┘
```

#### 4.2.4 シグナル分析

```
🎯 シグナル分析
==============================
  🟢 MACD陽性: 0.01 (買いシグナル)
  🔴 RSI過買い: 70.03 (売りシグナル)
```

### 4.3 カラーコーディング

#### カラー設定

```python
colors = {
    "bullish": "green",      # 買いシグナル
    "bearish": "red",        # 売りシグナル
    "neutral": "yellow",     # 中立
    "overbought": "red",     # 過買い
    "oversold": "green",     # 過売り
    "normal": "white",       # 通常
}
```

#### 指標別カラー判定

- **RSI**: 70 以上=赤、30 以下=緑、30-70=白
- **MACD**: 0 以上=緑、0 以下=赤
- **ストキャスティクス**: 80 以上=赤、20 以下=緑、20-80=白
- **その他**: 白（デフォルト）

## 5. データフロー

### 5.1 データ取得フロー

```
1. 価格データ取得
   ↓
2. テクニカル指標計算（TA-Lib）
   ↓
3. データベース保存
   ↓
4. 可視化データ取得
   ↓
5. 表示形式変換
   ↓
6. CLI出力
```

### 5.2 統合システムフロー

```
1. 基盤データ復元
   ↓
2. 差分データ更新
   ↓
3. テクニカル指標計算
   ↓
4. 可視化・分析
   ↓
5. 結果表示
```

## 6. パフォーマンス仕様

### 6.1 データ処理能力

#### 計算性能

- **TA-Lib**: C 言語実装による高速計算
- **並列処理**: 時間足別並列計算
- **メモリ効率**: ストリーミング処理

#### 処理時間

- **M5 時間足**: 約 1,370 件/指標（数秒）
- **H1 時間足**: 約 6,200 件/指標（数十秒）
- **H4 時間足**: 約 12,200 件/指標（1-2 分）
- **D1 時間足**: 約 17,900 件/指標（2-3 分）

### 6.2 データ容量

#### 現在のデータ量

- **総テクニカル指標数**: 821,216 件
- **データベースサイズ**: 約 50MB
- **日次増加量**: 約 1,000-2,000 件

## 7. エラーハンドリング

### 7.1 エラー種別

#### データ取得エラー

- **API 接続エラー**: リトライ機能
- **データ不足エラー**: 最小データ数チェック
- **形式エラー**: データ検証

#### 計算エラー

- **TA-Lib 計算エラー**: 代替計算方法
- **メモリ不足エラー**: バッチ処理
- **精度エラー**: 数値検証

### 7.2 ログ出力

#### ログレベル

- **INFO**: 正常処理
- **WARNING**: 軽微な問題
- **ERROR**: 重大な問題
- **DEBUG**: 詳細情報

## 8. 拡張性

### 8.1 新指標追加

#### 追加可能な指標

- **フィボナッチリトレースメント**
- **Ichimoku Cloud**
- **Williams %R**
- **CCI (Commodity Channel Index)**
- **ADX (Average Directional Index)**

#### 追加手順

1. TA-Lib 関数の確認
2. 計算ロジックの実装
3. データベーススキーマ更新
4. 可視化ロジック追加
5. テスト実行

### 8.2 新時間足追加

#### 追加可能な時間足

- **M1**: 1 分足
- **M15**: 15 分足
- **H6**: 6 時間足
- **W1**: 週足
- **M1**: 月足

### 8.3 新可視化機能

#### 追加可能な機能

- **チャート表示**: matplotlib/plotly 統合
- **アニメーション**: リアルタイム更新
- **エクスポート**: CSV/Excel 出力
- **Web API**: RESTful API 提供
- **モバイル対応**: レスポンシブ表示

## 9. セキュリティ

### 9.1 データセキュリティ

#### データ保護

- **暗号化**: データベース暗号化
- **アクセス制御**: ユーザー権限管理
- **バックアップ**: 定期バックアップ

#### API セキュリティ

- **レート制限**: API 呼び出し制限
- **認証**: API キー管理
- **監査**: アクセスログ

## 10. 運用・保守

### 10.1 監視項目

#### システム監視

- **CPU 使用率**: 計算負荷監視
- **メモリ使用率**: メモリ消費監視
- **ディスク使用率**: ストレージ監視
- **レスポンス時間**: 処理時間監視

#### データ監視

- **データ品質**: 異常値検出
- **データ量**: 増加率監視
- **データ整合性**: 一貫性チェック

### 10.2 メンテナンス

#### 定期メンテナンス

- **データクリーンアップ**: 古いデータ削除
- **インデックス最適化**: データベース最適化
- **ログローテーション**: ログファイル管理

#### 障害対応

- **自動復旧**: システム自動復旧
- **手動復旧**: 手動復旧手順
- **エスカレーション**: 問題エスカレーション

## 11. 今後の展開

### 11.0 優先実装機能

#### Discord 配信機能（最優先）

- **リアルタイムシグナル通知**
  - 短期戦略（M5-H1）のシグナル自動配信
  - カスタマイズ可能な通知条件設定
  - 複数 Discord チャンネル対応
  - 通知頻度制御（即座/5 分/15 分/1 時間）
- **通知内容**
  - シグナルタイプ（買い/売り/ホールド）
  - 信頼度レベル
  - 関連指標の値
  - 推奨アクション
- **設定機能**
  - ユーザー別通知設定
  - 時間足別フィルタリング
  - 重要度別通知レベル

#### アラートシステム

- **条件付き通知機能**
  - RSI 過買い/過売りアラート
  - MACD クロスオーバーアラート
  - ボリンジャーバンドブレイクアラート
  - 価格レベルアラート
- **通知方法**
  - Discord
  - メール
  - プッシュ通知
  - SMS

### 11.1 短期計画（3 ヶ月）

#### 機能拡張

- **Discord 配信機能**: リアルタイムシグナル通知
  - 短期戦略シグナル自動配信
  - カスタマイズ可能な通知条件
  - 複数チャンネル対応
- **機械学習統合**: 予測モデル追加
- **リアルタイム更新**: ストリーミング処理
- **モバイル対応**: スマートフォン対応

#### パフォーマンス向上

- **キャッシュ機能**: Redis 統合
- **分散処理**: マルチプロセス対応
- **データ圧縮**: ストレージ最適化

#### 新機能追加

- **アラートシステム**: 条件付き通知機能
- **バックテスト機能**: 戦略検証システム
- **ポートフォリオ管理**: 複数通貨ペア管理
- **リスク管理**: 自動ストップロス設定

### 11.2 中期計画（6 ヶ月）

#### プラットフォーム拡張

- **Web UI**: ブラウザベース UI
- **API 提供**: 外部システム連携
- **クラウド対応**: AWS/Azure 対応

#### 分析機能強化

- **AI 分析**: 深層学習統合
- **感情分析**: ニュース感情分析
- **リスク管理**: 自動リスク評価
- **ダイバージェンス検出**: 価格と指標の乖離分析
- **サポート・レジスタンス自動検出**: 重要レベル自動判定
- **ボラティリティ予測**: 将来のボラティリティ予測

### 11.3 長期計画（1 年）

#### エコシステム構築

- **マーケットプレイス**: 指標・戦略共有
- **コミュニティ**: ユーザーコミュニティ
- **教育機能**: 学習コンテンツ
- **自動売買システム**: アルゴリズム取引
- **ソーシャルトレーディング**: トレーダー間の情報共有

#### グローバル展開

- **多言語対応**: 国際化対応
- **地域別分析**: 地域特化分析
- **規制対応**: 各国の金融規制対応

---

## 付録

### A. コマンドリファレンス

#### 基本コマンド

```bash
# 可視化
exchange-analytics data visualize [OPTIONS]

# 計算
exchange-analytics data calculate-unified [OPTIONS]

# データ表示
exchange-analytics data show [OPTIONS]
```

### B. 設定ファイル

#### 環境変数

```bash
DATABASE_URL=sqlite+aiosqlite:///data/exchange_analytics.db
PYTHONPATH=/app
```

### C. トラブルシューティング

#### よくある問題

1. **データが表示されない**: データベース接続確認
2. **計算が遅い**: メモリ使用量確認
3. **エラーが発生**: ログファイル確認

---

**作成日**: 2025 年 8 月 14 日
**バージョン**: 1.0.0
**作成者**: Exchange Analytics Team
