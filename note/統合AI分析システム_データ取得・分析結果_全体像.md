# 統合 AI 分析システム - データ取得・分析結果の全体像

## 1. データ取得の種類

### A. 価格データ（Yahoo Finance）

**通貨ペア**

- USD/JPY（メイン分析対象）
- EUR/USD（USD 強弱分析用）
- GBP/USD（USD 強弱分析用）
- EUR/JPY（JPY 強弱分析用）
- GBP/JPY（JPY 強弱分析用）

**時間足構成**
| 時間足 | 期間 | 間隔 | データ件数 | 用途 |
|--------|------|------|------------|------|
| D1（日足） | 1 年 | 1 日 | 258 件 | 長期トレンド分析、MA200 計算 |
| H4（4 時間足） | 1 ヶ月 | 1 時間 | 495 件 | 中期トレンド分析 |
| H1（1 時間足） | 1 週間 | 1 時間 | 119 件 | 短期トレンド分析 |
| M5（5 分足） | 3 日 | 5 分 | 758 件 | 精密エントリータイミング |

**データ形式**

- OHLCV（Open, High, Low, Close, Volume）
- 日本時間（JST）でのタイムスタンプ
- リアルタイム更新（5 分間隔）

### B. 通貨相関データ

**USD 強弱分析**

- EUR/USD、GBP/USD の変動から USD の強弱を判定
- 方向性：strong/weak/neutral
- 信頼度：0-100%

**JPY 強弱分析**

- EUR/JPY、GBP/JPY の変動から JPY の強弱を判定
- 方向性：strong/weak/neutral
- 信頼度：0-100%

## 2. テクニカル指標分析結果

### A. RSI（相対力指数）分析

**期間設定**

- RSI_LONG（70 期間）：長期トレンドの過熱感判定
- RSI_MEDIUM（50 期間）：中期トレンドの方向性判定
- RSI_SHORT（30 期間）：短期エントリータイミング判定

**状態分類**

- **overbought**（買われすぎ）：70 以上
- **neutral**（中立）：30-70
- **oversold**（売られすぎ）：30 以下

**シグナル判定**

- **bullish**（買い）：上昇トレンド
- **bearish**（売り）：下降トレンド
- **neutral**（中立）：横ばい

**特殊機能**

- ダイバージェンス検出：価格と RSI の乖離検出
- 複数期間統合分析：時間足別の RSI 統合

### B. MACD（移動平均収束拡散）分析

**パラメータ設定**

- 高速 EMA：12 期間
- 低速 EMA：26 期間
- シグナル線：9 期間

**分析要素**

- **MACD ライン**：12EMA - 26EMA
- **シグナルライン**：9EMA
- **ヒストグラム**：MACD - シグナル

**クロス判定**

- **ゴールデンクロス**：MACD がシグナルを上向きにクロス
- **デッドクロス**：MACD がシグナルを下向きにクロス

**ゼロライン位置**

- **above**：MACD が 0 より上
- **below**：MACD が 0 より下
- **neutral**：MACD が 0 付近

### C. ボリンジャーバンド分析

**パラメータ設定**

- 期間：20 期間
- 標準偏差：2σ

**バンド構成**

- **上限バンド**：MA20 + 2σ
- **中間バンド**：MA20
- **下限バンド**：MA20 - 2σ

**分析機能**

- **バンド位置**：価格のバンド内での位置
- **バンドウォーク**：価格のバンド内での移動パターン
- **バンド幅**：ボラティリティの測定（%表示）

### D. 移動平均線分析

**期間設定**
| 時間足 | 長期 | 中期 | 短期 |
|--------|------|------|------|
| D1 | MA200 | MA50 | - |
| H4 | - | MA50 | MA20 |
| H1 | - | - | MA20 |
| M5 | - | - | MA20 |

**分析機能**

- **位置関係**：価格と移動平均線の位置関係
- **傾き分析**：移動平均線の方向性
- **クロス判定**：移動平均線間のクロス

### E. フィボナッチリトレースメント分析

**フィボナッチレベル**

- 0.236, 0.382, 0.5, 0.618, 0.786

**期間別階層アプローチ**
| 時間足 | 期間 | 用途 |
|--------|------|------|
| D1 | 90 日 | 長期トレンド |
| H4 | 14 日 | 中期トレンド |
| H1 | 24 時間 | 短期トレンド |
| M5 | 48 期間 | 精密タイミング |

**分析機能**

- **スイングポイント検出**：高値・安値の自動検出
- **サポート・レジスタンス**：フィボナッチレベルでの価格帯
- **押し目・戻り確認**：エントリータイミングの最適化

## 3. 通貨相関分析結果

### A. USD 強弱分析

**分析対象**

- EUR/USD、GBP/USD の変動率

**判定結果**

- **方向性**：strong/weak/neutral
- **信頼度**：0-100%
- **サポート要因**：USD を強くする要因のリスト
- **リスク要因**：USD を弱くする要因のリスト

### B. JPY 強弱分析

**分析対象**

- EUR/JPY、GBP/JPY の変動率

**判定結果**

- **方向性**：strong/weak/neutral
- **信頼度**：0-100%
- **サポート要因**：JPY を強くする要因のリスト
- **リスク要因**：JPY を弱くする要因のリスト

### C. USD/JPY 統合予測

**予測要素**

- **現在レート**：リアルタイム価格
- **現在変動**：前回からの変動率
- **予測方向**：上昇期待/下落懸念/中立
- **予測信頼度**：0-100%
- **戦略バイアス**：LONG/SHORT/NEUTRAL
- **トレンド整合**：順行/逆行

## 4. AI 分析結果

### A. 統合シナリオ分析

**分析階層**

1. **相関分析**：他通貨の動きから見る USD/JPY 方向性
2. **大局観**：D1・H4 マルチタイムフレーム分析
3. **戦術**：H1 エントリーゾーン・タイミング分析
4. **タイミング**：M5 エントリーポイント

**M5 精密タイミング要素**

- MA20 とボリンジャーバンドの短期動向
- RSI 値による最終エントリー判定
- H1 の MA20 の動向
- H1 のフィボナッチレベルでの押し目・戻り確認
- 過熱感の確認

### B. エントリー戦略

**価格指示**

- **エントリー価格**：具体的な価格帯（根拠付き）
- **利確目標**：段階的利確目標（pips 数明記）
- **損切り価格**：リスク管理価格（pips 数明記）

**リスク管理**

- **リスクリワード比率**：1:2 以上
- **具体的な価格と pips 数**：明確な数値指示
- **フィボナッチレベル活用**：サポート・レジスタンスライン

## 5. システム監視情報

### A. パフォーマンス指標

**データ取得**

- **成功率**：各通貨ペアの取得状況
- **取得時間**：各時間足のデータ取得時間
- **エラー率**：API 接続エラーの発生状況

**分析処理**

- **計算時間**：各テクニカル指標の計算時間
- **キャッシュ効率**：分析結果の再利用状況
- **メモリ使用量**：システムリソース状況

### B. キャッシュ管理

**キャッシュ機能**

- **分析結果キャッシュ**：重複計算の回避
- **有効期限管理**：データの鮮度確保
- **自動クリーンアップ**：古いキャッシュの削除

## 6. 通知・配信情報

### A. Discord 配信内容

**統合分析レポート**

- 包括的な市場分析サマリー
- テクニカル指標の統合結果
- 通貨相関性の分析結果
- AI 予測による市場展望

**テクニカル指標詳細**

- 各時間足の指標値
- シグナル判定結果
- トレンド方向性
- エントリーポイント

### B. アラート機能

**パターン検出**

- 特定の価格パターンの自動検出
- リアルタイム通知配信
- 重要度別の優先度設定

**システム監視**

- **エラー通知**：システムエラーの即座通知
- **パフォーマンス警告**：システム性能の低下警告
- **API 制限警告**：Yahoo Finance API 制限の警告

## 7. システム稼働状況

### A. 実行頻度

- **統合 AI 分析**：2 時間間隔（平日 8:00-2:00）
- **データ取得**：5 分間隔（平日 24 時間）
- **日次レポート**：毎日 6:00 JST
- **週次レポート**：毎週土曜日 6:00 JST

### B. ログ管理

- **ログファイル**：18,410 行（882KB）
- **ログローテーション**：自動圧縮・削除
- **エラー追跡**：詳細なエラーログ記録

## 8. 実装ファイル構成

### A. メインスクリプト

- `scripts/cron/integrated_ai_discord.py`：統合 AI 分析メインスクリプト
- `scripts/cron/daily_report.py`：日次レポート生成
- `scripts/cron/weekly_report.py`：週次レポート生成

### B. 分析モジュール

- `src/infrastructure/analysis/technical_indicators.py`：テクニカル指標分析
- `src/infrastructure/analysis/currency_correlation_analyzer.py`：通貨相関分析
- `src/infrastructure/external_apis/yahoo_finance_client.py`：Yahoo Finance API

### C. 設定ファイル

- `config/crontab/production/current_crontab.txt`：本番 crontab 設定
- `config/crontab/production/daily_schedule.cron`：日次スケジュール
- `config/crontab/production/weekly_schedule.cron`：週次スケジュール

## 9. 技術仕様

### A. 使用技術

- **Python 3.11**：メイン開発言語
- **Yahoo Finance API**：価格データ取得
- **OpenAI GPT-4**：AI 分析生成
- **Discord Webhook**：通知配信
- **PostgreSQL**：データベース
- **Redis**：キャッシュ管理

### B. ライブラリ

- **pandas**：データ処理
- **numpy**：数値計算
- **ta**：テクニカル指標計算
- **httpx**：HTTP 通信
- **rich**：コンソール表示
- **pytz**：タイムゾーン管理

## 10. 運用・保守

### A. 監視項目

- **API 接続状況**：Yahoo Finance API の稼働状況
- **データ品質**：取得データの完全性・正確性
- **分析精度**：テクニカル指標の計算精度
- **配信状況**：Discord 通知の配信状況

### B. トラブルシューティング

- **データ取得エラー**：API 制限・ネットワーク問題
- **分析計算エラー**：データ不足・計算エラー
- **配信エラー**：Discord Webhook 接続問題
- **システムエラー**：メモリ不足・CPU 負荷

---

**作成日**: 2025 年 8 月 26 日  
**更新日**: 2025 年 8 月 26 日  
**バージョン**: 1.0  
**作成者**: Exchange Analytics System
